#!/bin/bash
v2servn=$(awk 'NR==1{print}' /var/www/html/nodepre.txt)
uuidnum=$(awk 'NR==2{print}' /var/www/html/nodepre.txt)
v2path=$(awk 'NR==3{print}' /var/www/html/nodepre.txt)

domain=$(echo -e $v2servn | cut -d : -f1)
port=$(echo -e $v2servn | cut -d : -f2)

if [[ $port =~ ^[1-9]+$ ]]; then
sed -i "$(sed -n -e '/"port":/=' /etc/v2ray/config.json | awk 'NR==3{print}')s/.*/"'"port"'": "$port",/" /etc/v2ray/config.json
else
sed -i "$(sed -n -e '/"port":/=' /etc/v2ray/config.json | awk 'NR==3{print}')s/.*/"'"port"'": "443",/" /etc/v2ray/config.json
fi

sed -i "$(sed -n -e '/"address":/=' /etc/v2ray/config.json | awk 'NR==1{print}')s/.*/"'"address"'": "'"'$domain'"'",/" /etc/v2ray/config.json
sed -i "$(sed -n -e '/"serverName":/=' /etc/v2ray/config.json | awk 'NR==1{print}')s/.*/"'"serverName"'": "'"'$domain'"'",/" /etc/v2ray/config.json
sed -i "$(sed -n -e '/"Host":/=' /etc/v2ray/config.json | awk 'NR==1{print}')s/.*/"'"Host"'": "'"'$domain'"'"/" /etc/v2ray/config.json

sed -i "$(sed -n -e '/"id":/=' /etc/v2ray/config.json | awk 'NR==1{print}')s/.*/"'"id"'": "'"'$uuidnum'"'",/" /etc/v2ray/config.json
sed -i "$(sed -n -e '/"path":/=' /etc/v2ray/config.json | awk 'NR==1{print}')s/.*/"'"path"'": "'"\'$v2path'"'",/" /etc/v2ray/config.json

systemctl restart v2ray
rm -rf /var/www/html/nodepre.txt